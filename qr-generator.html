<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Генератор для столов | Мынбала</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@300;400;700&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <div class="qr-generator-page">
        <div class="qr-header">
            <h1><i class="fas fa-qrcode"></i> QR Генератор для столов</h1>
            <p>Создавайте QR-коды для быстрого заказа с каждого стола</p>
        </div>

        <div class="qr-controls">
            <div class="control-group">
                <label>Номер стола:</label>
                <input type="number" id="tableNumber" min="1" max="100" value="1" onchange="generateQR()">
            </div>
            
            <div class="control-group">
                <label>Размер QR-кода:</label>
                <select id="qrSize" onchange="generateQR()">
                    <option value="200">Маленький (200px)</option>
                    <option value="300" selected>Средний (300px)</option>
                    <option value="400">Большой (400px)</option>
                </select>
            </div>

            <div class="control-group">
                <button onclick="generateAllTables()" class="generate-all-btn">
                    <i class="fas fa-magic"></i> Создать QR для всех столов (1-50)
                </button>
            </div>
        </div>

        <div class="qr-result">
            <div class="qr-card">
                <div class="qr-header-card">
                    <h3>Стол №<span id="currentTableNumber">1</span></h3>
                    <p>Отсканируйте для заказа</p>
                </div>
                <div class="qr-code-container">
                    <canvas id="qrcode"></canvas>
                </div>
                <div class="qr-actions">
                    <button onclick="downloadQR()" class="download-btn">
                        <i class="fas fa-download"></i> Скачать PNG
                    </button>
                    <button onclick="printQR()" class="print-btn">
                        <i class="fas fa-print"></i> Печать
                    </button>
                    <button onclick="testQR()" class="test-btn">
                        <i class="fas fa-external-link-alt"></i> Тест
                    </button>
                </div>
            </div>
        </div>

        <div class="batch-generation" id="batchGeneration" style="display: none;">
            <h3>Массовая генерация QR-кодов</h3>
            <div class="batch-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span id="progressText">0 / 0</span>
            </div>
            <div class="batch-results" id="batchResults"></div>
            <button onclick="downloadAllQRs()" class="download-all-btn" id="downloadAllBtn" style="display: none;">
                <i class="fas fa-download"></i> Скачать все как ZIP
            </button>
        </div>

        <div class="qr-info">
            <div class="info-section">
                <h3><i class="fas fa-info-circle"></i> Как использовать</h3>
                <ol>
                    <li>Выберите номер стола</li>
                    <li>Скачайте QR-код</li>
                    <li>Распечатайте и разместите на столе</li>
                    <li>Гости смогут заказывать, сканируя код</li>
                </ol>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-mobile-alt"></i> Функции QR-заказа</h3>
                <ul>
                    <li>✅ Персональные рекомендации по возрасту</li>
                    <li>✅ Уведомления о готовности заказа</li>
                    <li>✅ Отслеживание статуса приготовления</li>
                    <li>✅ Поддержка казахского и русского языков</li>
                    <li>✅ Сохранение заказа при отключении интернета</li>
                </ul>
            </div>
        </div>

        <div class="back-to-main">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Назад к главной
            </a>
        </div>
    </div>

    <style>
        .qr-generator-page {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
        }

        .qr-header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .qr-header h1 {
            font-family: 'Comic Neue', cursive;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .qr-controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .control-group input,
        .control-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--bg-light);
            border-radius: 10px;
            font-size: 1rem;
        }

        .generate-all-btn {
            background: var(--gradient-1);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
        }

        .generate-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .qr-result {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }

        .qr-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            max-width: 400px;
        }

        .qr-header-card h3 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .qr-header-card p {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .qr-code-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .qr-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .qr-actions button {
            padding: 10px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .download-btn {
            background: var(--gradient-2);
            color: white;
        }

        .print-btn {
            background: var(--gradient-3);
            color: var(--text-dark);
        }

        .test-btn {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        .qr-actions button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .batch-generation {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .batch-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .progress-bar {
            flex: 1;
            height: 20px;
            background: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-1);
            width: 0%;
            transition: width 0.3s ease;
        }

        .batch-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .mini-qr-card {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .mini-qr-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .mini-qr-card canvas {
            width: 80px !important;
            height: 80px !important;
        }

        .download-all-btn {
            background: var(--gradient-2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
        }

        .qr-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto 40px;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .info-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-section ol,
        .info-section ul {
            color: var(--text-dark);
            line-height: 1.6;
        }

        .info-section li {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .qr-actions {
                grid-template-columns: 1fr;
            }
            
            .batch-results {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .qr-info {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        let currentQRData = '';
        let batchQRs = [];

        function generateQR() {
            const tableNumber = document.getElementById('tableNumber').value;
            const qrSize = document.getElementById('qrSize').value;
            const canvas = document.getElementById('qrcode');
            
            // Generate URL for QR order page
            const baseUrl = window.location.origin + window.location.pathname.replace('qr-generator.html', '');
            const qrUrl = `${baseUrl}qr-order.html?table=${tableNumber}`;
            
            currentQRData = qrUrl;
            
            // Update table number display
            document.getElementById('currentTableNumber').textContent = tableNumber;
            
            // Generate QR code
            QRCode.toCanvas(canvas, qrUrl, {
                width: parseInt(qrSize),
                margin: 2,
                color: {
                    dark: '#2d3436',
                    light: '#ffffff'
                }
            }, function (error) {
                if (error) console.error(error);
            });
        }

        function downloadQR() {
            const canvas = document.getElementById('qrcode');
            const tableNumber = document.getElementById('tableNumber').value;
            
            const link = document.createElement('a');
            link.download = `table-${tableNumber}-qr.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function printQR() {
            const canvas = document.getElementById('qrcode');
            const tableNumber = document.getElementById('tableNumber').value;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>QR код - Стол №${tableNumber}</title>
                        <style>
                            body { text-align: center; font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #ff6b6b; margin-bottom: 10px; }
                            p { color: #636e72; margin-bottom: 20px; }
                            canvas { border: 2px solid #ddd; border-radius: 10px; }
                            .instructions { margin-top: 20px; font-size: 14px; color: #636e72; }
                        </style>
                    </head>
                    <body>
                        <h1>МЫНБАЛА</h1>
                        <h2>Стол №${tableNumber}</h2>
                        <p>Отсканируйте QR-код для заказа</p>
                        <img src="${canvas.toDataURL()}" />
                        <div class="instructions">
                            <p>📱 Наведите камеру телефона на QR-код</p>
                            <p>🍽️ Выберите блюда из нашего меню</p>
                            <p>⏰ Получите уведомление когда заказ будет готов</p>
                        </div>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function testQR() {
            const tableNumber = document.getElementById('tableNumber').value;
            const baseUrl = window.location.origin + window.location.pathname.replace('qr-generator.html', '');
            const testUrl = `${baseUrl}qr-order.html?table=${tableNumber}`;
            
            window.open(testUrl, '_blank');
        }

        async function generateAllTables() {
            const batchDiv = document.getElementById('batchGeneration');
            const resultsDiv = document.getElementById('batchResults');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const downloadBtn = document.getElementById('downloadAllBtn');
            
            batchDiv.style.display = 'block';
            resultsDiv.innerHTML = '';
            downloadBtn.style.display = 'none';
            batchQRs = [];
            
            const totalTables = 50;
            const baseUrl = window.location.origin + window.location.pathname.replace('qr-generator.html', '');
            
            for (let i = 1; i <= totalTables; i++) {
                const qrUrl = `${baseUrl}qr-order.html?table=${i}`;
                
                // Create mini canvas
                const canvas = document.createElement('canvas');
                
                await new Promise((resolve) => {
                    QRCode.toCanvas(canvas, qrUrl, {
                        width: 200,
                        margin: 2,
                        color: {
                            dark: '#2d3436',
                            light: '#ffffff'
                        }
                    }, function (error) {
                        if (error) console.error(error);
                        
                        // Create mini card
                        const miniCard = document.createElement('div');
                        miniCard.className = 'mini-qr-card';
                        miniCard.innerHTML = `
                            <canvas width="80" height="80"></canvas>
                            <p>Стол №${i}</p>
                        `;
                        
                        // Copy canvas to mini canvas
                        const miniCanvas = miniCard.querySelector('canvas');
                        const ctx = miniCanvas.getContext('2d');
                        ctx.drawImage(canvas, 0, 0, 80, 80);
                        
                        miniCard.onclick = () => downloadTableQR(i, canvas);
                        
                        resultsDiv.appendChild(miniCard);
                        
                        // Store for batch download
                        batchQRs.push({
                            table: i,
                            canvas: canvas,
                            dataUrl: canvas.toDataURL()
                        });
                        
                        // Update progress
                        const progress = (i / totalTables) * 100;
                        progressFill.style.width = `${progress}%`;
                        progressText.textContent = `${i} / ${totalTables}`;
                        
                        resolve();
                    });
                });
                
                // Small delay to prevent browser freezing
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            downloadBtn.style.display = 'block';
        }

        function downloadTableQR(tableNumber, canvas) {
            const link = document.createElement('a');
            link.download = `table-${tableNumber}-qr.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function downloadAllQRs() {
            // Note: In a real implementation, you'd use JSZip library
            alert('Функция массового скачивания требует библиотеку JSZip. Пока что скачивайте QR-коды по одному.');
            
            // Alternative: download all one by one
            batchQRs.forEach((qr, index) => {
                setTimeout(() => {
                    downloadTableQR(qr.table, qr.canvas);
                }, index * 500); // 500ms delay between downloads
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateQR();
        });
    </script>
</body>
</html>
